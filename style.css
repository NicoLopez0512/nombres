document.addEventListener("DOMContentLoaded", cargarHistorial);

let fechaTemporal = "";
let nombreTemporal = "";

function guardarFecha() {
    const fecha = document.getElementById("fechaInput").value;
    if (fecha === "") {
        alert("Selecciona una fecha");
        return;
    }
    fechaTemporal = fecha;
    alert("Fecha guardada correctamente");
}

function guardarNombre() {
    const nombre = document.getElementById("nombreInput").value.trim();
    if (nombre === "") {
        alert("Ingresa un nombre");
        return;
    }
    nombreTemporal = nombre;
    document.getElementById("nombreInput").value = "";
    alert("Nombre guardado correctamente");
}

function agregarRegistro() {
    if (fechaTemporal === "" || nombreTemporal === "") {
        alert("Debes guardar una fecha y un nombre antes");
        return;
    }

    let historial = JSON.parse(localStorage.getItem("historial")) || [];

    historial.push({
        fecha: fechaTemporal,
        nombre: nombreTemporal
    });

    localStorage.setItem("historial", JSON.stringify(historial));

    nombreTemporal = "";
    mostrarHistorial();
}

function cargarHistorial() {
    mostrarHistorial();
}

function mostrarHistorial() {
    const tabla = document.getElementById("tablaRegistros");
    tabla.innerHTML = "";

    let historial = JSON.parse(localStorage.getItem("historial")) || [];

    historial.forEach(registro => {
        const fila = document.createElement("tr");

        const tdFecha = document.createElement("td");
        tdFecha.textContent = registro.fecha;

        const tdNombre = document.createElement("td");
        tdNombre.textContent = registro.nombre;

        fila.appendChild(tdFecha);
        fila.appendChild(tdNombre);
        tabla.appendChild(fila);
    });
}

function exportarExcel() {
    let historial = JSON.parse(localStorage.getItem("historial")) || [];

    if (historial.length === 0) {
        alert("No hay registros para generar el informe");
        return;
    }

    let datos = historial.map((r, index) => ({
        "NÂ°": index + 1,
        "Fecha": r.fecha,
        "Nombre": r.nombre
    }));

    let hoja = XLSX.utils.json_to_sheet(datos);
    let libro = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(libro, hoja, "Historial");

    XLSX.writeFile(libro, "informe_historial.xlsx");
}
